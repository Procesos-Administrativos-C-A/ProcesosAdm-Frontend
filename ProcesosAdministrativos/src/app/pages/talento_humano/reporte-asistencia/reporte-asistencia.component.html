<app-navbar [rol]="2"></app-navbar>
<main class=" w-screen pb-14 relative min-h-[760px] overscroll-contain overflow-y-auto ">
    <div class=" w-11/12 mx-auto my-14 flex flex-col items-center justify-start   ">
        <h1 class="text-center text-3xl font-semibold leading-7 text-gray-900 my-8">Reporte de Asistencia</h1>
        <form action="" [formGroup]="empleadosForm" class="w-1/2 mb-4 mr-auto flex flex-wrap gap-8"
            (ngSubmit)="generarReporte()">

            <div class=" w-[25%]">
                <label for="fechaInicio" class="block font-bold mb-2">Fecha Inicio:</label>
                <input type="date" name="fechaInicio" class="border border-gray-400 rounded p-2"
                    formControlName="fechaInicio">
            </div>

            <div class=" w-[25%]">
                <label for="fechaFin" class="block font-bold mb-2">Fecha Fin:</label>
                <input type="date" name="fechaFin" class="border border-gray-400 rounded p-2"
                    formControlName="fechaFin">
            </div>

            <div class=" w-full" formArrayName="empleados">
                <table class="table-auto w-full  relative border-collapse">

                    <tr>
                        <th class=" text-start">
                            Cargo:
                        </th>
                        <th class="pl-2 text-start">
                            Empleado:
                        </th>



                    </tr>
                    <tr *ngFor="let empleado of empleadosArray.controls; let j = index">
                        <td class="w-[35%] p-4 ">
                            <select name="cargo" class="rounded-md" (change)="asignarCargoEmpleado(j,$event)">
                                <option value="OPERADOR">Operador</option>
                                <option value="AUXILIAR DE ABORDAJE Y TAQUILLA">Auxiliar de A&T</option>
                                <option value="INGENIERO DE MANTENIMIENTO">Ingeniero de MTTO</option>
                                <option value="TECNICO DE MANTENIMIENTO">TÃ©cnico MTTO</option>
                            </select>
                        </td>
                        <td class="w-[40%] p-4 relative">
                            <select name="empleado" class="rounded-md"
                                (change)="asignarNombreEmpleado(empleado.get('cargo')?.value,j,$event)">
                                <option value="">{{empleado.get('nombre')?.value}}</option>
                                <option *ngFor="let empleado of empleados[empleado.get('cargo')?.value]"
                                    value="{{empleado.nombre}}"> {{empleado.nombre +' '+ empleado.apellidos}} </option>
                            </select>
                        </td>
                        <td class="w-[10%] relative">
                            <div class="flex flex-col ml-2">
                                <button *ngIf="j === empleadosArray.length - 1 ; else botonEliminar"
                                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-2"
                                    (click)="agregarEmpleado()">+</button>
                                <ng-template #botonEliminar>
                                    <button id="botonEliminar"
                                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
                                        (click)="eliminarEmpleado(j)">-</button>
                                </ng-template>

                            </div>
                        </td>
                    </tr>
                </table>
                <button type="submit" [disabled]="!empleadosForm.valid"
                    class="flex items-center justify-center p-3 sm:w-[30%] telefono:w-3/4 mx-auto mt-8 rounded-md disabled:bg-red-500 bg-Primario text-TextoBlanco hover:bg-Secundario active:bg-gray-500">Generar
                    Reporte</button>
            </div>
        </form>
    </div>
    <div class="w-full h-[400px] flex justify-center items-center my-36 pr-40">
        <canvas id="canvas" class="w-3/4"></canvas>
    </div>
</main>